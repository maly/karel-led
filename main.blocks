<xml xmlns="https://developers.google.com/blockly/xml"><block type="pxt-on-start" id="lc|r%M/L]v.|sgqKG|rS" x="0" y="0"><statement name="HANDLER"><block type="typescript_statement" id="Cz!ktG9uhyl6Z(!#H*U5" editable="false"><mutation xmlns="http://www.w3.org/1999/xhtml" line0="class Board {" line1="    public isKarelActive: boolean;" line2="    public karelX: number;" line3="    public karelY: number;" line4="" line5="    public ledState: Image;" line6="    private karelDirection: Direction;" line7="" line8="    constructor() {" line9="        this.isKarelActive = true;" line10="        this.karelX = 2;" line11="        this.karelY = 2;" line12="        this.karelDirection = Direction.UP;" line13="        this.ledState = images.createImage(`" line14="            . . . . ." line15="            . . . . ." line16="            . . . . ." line17="            . . . . ." line18="            . . . . ." line19="            `);" line20="    }" line21="" line22="    pressedA() {" line23="        if (!this.isKarelActive) {" line24="            return;" line25="        }" line26="        this.karelDirection = (this.karelDirection + 1) % 4;" line27="    }" line28="" line29="    pressedB() {" line30="        if (!this.isKarelActive) {" line31="            return;" line32="        }" line33="        this.ledState.setPixel(this.karelX, this.karelY, true);" line34="        this.moveKarel()" line35="    }" line36="" line37="    shake() {" line38="        if (!this.isKarelActive) {" line39="            return;" line40="        }" line41="        this.moveKarel()" line42="    }" line43="" line44="    private moveKarel() {" line45="        if (!this.isKarelActive) {" line46="            return;" line47="        }" line48="        switch (this.karelDirection) {" line49="            case Direction.UP:" line50="                if (this.karelY &gt; 0) {" line51="                    this.karelY -= 1;" line52="                }" line53="                break;" line54="            case Direction.LEFT:" line55="                if (this.karelX &gt; 0) {" line56="                    this.karelX -= 1;" line57="                }" line58="                break;" line59="            case Direction.DOWN:" line60="                if (this.karelY &lt; 4) {" line61="                    this.karelY += 1;" line62="                }" line63="                break;" line64="            case Direction.RIGHT:" line65="                if (this.karelX &lt; 4) {" line66="                    this.karelX += 1;" line67="                }" line68="                break;" line69="        }" line70="    }" line71="" line72="    pressedAB() {" line73="        this.isKarelActive = !this.isKarelActive;" line74="    }" line75="" line76="    update() {" line77="        this.ledState.showImage(0);" line78="    }" line79="}" numlines="80"></mutation><next><block type="typescript_statement" id="2Zoa3P[UXc`o[1_2Lm?-" editable="false"><mutation xmlns="http://www.w3.org/1999/xhtml" line0="const board = new Board();" numlines="1" declaredvars="board"></mutation><next><block type="typescript_statement" id="j^2c{rK.0(Mr#7c)l;bZ" editable="false"><mutation xmlns="http://www.w3.org/1999/xhtml" line0="enum Direction {" line1="    UP = 0," line2="    LEFT," line3="    DOWN," line4="    RIGHT" line5="}" numlines="6"></mutation></block></next></block></next></block></statement></block><block type="device_button_event" id="r$@8?S((`gVT,K!tVsKB" x="631" y="0"><field name="NAME">Button.B</field><statement name="HANDLER"><block type="typescript_statement" id="f2gk~)H]Ha#bMxX[#_Mr" editable="false"><mutation xmlns="http://www.w3.org/1999/xhtml" line0="board.pressedB();" numlines="1"></mutation><next><block type="typescript_statement" id="o7loFR;L2MJ[Kqtjo)J!" editable="false"><mutation xmlns="http://www.w3.org/1999/xhtml" line0="board.update();" numlines="1"></mutation></block></next></block></statement></block><block type="device_button_event" id="bAvM?Ce1G]C66=(oL.jS" x="930" y="0"><field name="NAME">Button.A</field><statement name="HANDLER"><block type="typescript_statement" id="OoG2dZM)#Rp!KX#+(LP." editable="false"><mutation xmlns="http://www.w3.org/1999/xhtml" line0="board.pressedA();" numlines="1"></mutation><next><block type="typescript_statement" id=";.92@WKvI+isO~*LlV/y" editable="false"><mutation xmlns="http://www.w3.org/1999/xhtml" line0="board.update();" numlines="1"></mutation></block></next></block></statement></block><block type="device_button_event" id="HWa2v$DI~`7QJ8],9}v@" x="1228" y="0"><field name="NAME">Button.AB</field><statement name="HANDLER"><block type="typescript_statement" id="ydmG#WH%OP,JH`_E*|mm" editable="false"><mutation xmlns="http://www.w3.org/1999/xhtml" line0="board.pressedAB();" numlines="1"></mutation><next><block type="typescript_statement" id="7xc*;9#l_3CE,cPV;.aM" editable="false"><mutation xmlns="http://www.w3.org/1999/xhtml" line0="board.update();" numlines="1"></mutation></block></next></block></statement></block><block type="device_forever" id="v(~$Ups9w}@5P6=ZAi;n" x="1544" y="0"><statement name="HANDLER"><block type="controls_if" id="q{Lg:o9zsBlAqJn$V$5A"><value name="IF0"><shadow type="logic_boolean"><field name="BOOL">TRUE</field></shadow><block type="typescript_expression" id="lhSf:rV}o7(`R@{-t]TQ" editable="false"><field name="EXPRESSION">board.isKarelActive</field></block></value><statement name="DO0"><block type="device_led_toggle" id="PGCp#:2{,_Juu7crH9d|"><value name="x"><shadow type="math_number_minmax"><mutation min="0" max="4"></mutation><field name="SLIDER">0</field></shadow><block type="typescript_expression" id="Qz_o{}{5pS#7Q!Bs-Ojq" editable="false"><field name="EXPRESSION">board.karelX</field></block></value><value name="y"><shadow type="math_number_minmax"><mutation min="0" max="4"></mutation><field name="SLIDER">0</field></shadow><block type="typescript_expression" id="~mHE5`i#4w3T{j,4j]`W" editable="false"><field name="EXPRESSION">board.karelY</field></block></value><next><block type="device_pause" id="+fQQ2ki;;n|xU4ScK?@c"><value name="pause"><shadow type="timePicker" id="pR5pXgjv@5L)qSV9x(Tv"><field name="ms">500</field></shadow></value></block></next></block></statement></block></statement></block><block type="device_gesture_event" id="-CDz:Ucgy2z5Bcx3z)2V" x="1995" y="0"><field name="NAME">Gesture.Shake</field><statement name="HANDLER"><block type="typescript_statement" id="O}@A7y,aPV3UqMGkLxS6" editable="false"><mutation xmlns="http://www.w3.org/1999/xhtml" line0="board.shake();" numlines="1"></mutation><next><block type="typescript_statement" id="YrD1YLXmk9_gT=M@4kHm" editable="false"><mutation xmlns="http://www.w3.org/1999/xhtml" line0="board.update();" numlines="1"></mutation></block></next></block></statement></block></xml>